{% extends "base.html" %}

{% block title %}Sort Products - FlowTex Factory Simulator{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">Sort Products</h1>
        <p class="text-muted">Sort all products using Merge Sort algorithm. Select a field to sort by.</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Sort Options</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('sort') }}">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="field" class="form-label">Sort By Field:</label>
                            <select class="form-select" id="field" name="field" required>
                                <option value="">-- Select a field --</option>
                                {% for value, label in sortable_fields %}
                                <option value="{{ value }}" {% if selected_field == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary">Sort Products</button>
                        </div>
                    </div>
                </form>
                <div class="mt-3">
                    <div class="alert alert-info">
                        <strong>Algorithm:</strong> Merge Sort (O(n log n) time complexity)
                        <br>
                        <small>Merge sort is a divide-and-conquer algorithm that recursively divides the array, sorts the subarrays, and merges them back together.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if sorted_products %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5>Sorted Products ({{ sorted_products|length }} items)
                    {% if selected_field %}
                    <span class="badge bg-light text-dark">Sorted by: {{ selected_field }}</span>
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark sticky-top">
                            <tr>
                                <th>#</th>
                                <th>Product ID</th>
                                <th>Product Line</th>
                                <th>Size</th>
                                <th>Color</th>
                                <th>Weight (g)</th>
                                <th>Defect Score</th>
                                <th>Production Timestamp</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in sorted_products %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td><strong>{{ product.product_id }}</strong></td>
                                <td>{{ product.product_line }}</td>
                                <td>{{ product.size }}</td>
                                <td>{{ product.color }}</td>
                                <td>{{ "%.1f"|format(product.weight_g) }}</td>
                                <td>{{ "%.3f"|format(product.raw_defect_score) }}</td>
                                <td>{{ product.production_timestamp }}</td>
                                <td>
                                    {% if product.inspected %}
                                        {% if product.passed_inspection %}
                                            <span class="badge bg-success">Accepted</span>
                                        {% else %}
                                            <span class="badge bg-danger">Rejected</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="badge bg-secondary">In Queue</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-md-12">
        <div class="alert alert-warning">
            <strong>No products to display.</strong> Please upload a CSV file first, then select a field to sort by.
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-3">
    <div class="col-md-12">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>
{% endblock %}

